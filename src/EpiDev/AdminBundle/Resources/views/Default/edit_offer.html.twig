<html>
<head>

  <!-- Date picker -->
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
  $( function() {
    $("#datepicker").datepicker({ dateFormat: "dd-mm-yy" }).val();
    $("#datepicker").datepicker("setDate" , "{{ offer.Begin|date('d-m-Y') }}");
  });
  </script>

</head>

<body>

  <center style="margin-bottom: 2%;">
    <b>--------------------------------------------------------------------------------------------------------------------------------------------</b>
    <br><br><br>HEADER<br><br><br>
    <b>--------------------------------------------------------------------------------------------------------------------------------------------</b>
  </center>

  <div style="width: 60%; position: absolute; margin-top: 2%;">
    <p>Titre :</p>
    <div id="title" contenteditable="true" style="height: 5%; border-style: solid; border-width: 1px; border-color: #c9c9c9;">
      {{ offer.Title }}
    </div>
  </div>

  <div style="width: 60%; position: absolute; margin-top: 2%;">
    <p>Référence :</p>
    <div id="" contenteditable="true" style="height: 5%; border-style: solid; border-width: 1px; border-color: #c9c9c9;">
      {{ offer.Référence }}
    </div>
  </div>

  <div>
    <p>Date :</p>
    <input type="text" id="datepicker"></input>
  </div>

  <div>
    Active :<input type="checkbox" id="active">
  </div>

  <select id="department" style="width:200px; height:40px;">
    <option value="agence">Département</option>
  </select>

  <select id="city" style="width:200px; height:40px;">
    <option value="agence">Ville</option>
  </select>

  <select id="agency" style="width:200px; height:40px;">
    <option value="agency">Agence</option>
  </select>

  <select id="domaine" style="width:200px; height:40px;">
    <option value="domaine">Domaine</option>
  </select>

  <select id="job" style="width:200px; height:40px;">
    <option value="job">Métier</option>
  </select>

  <div>
    Type d'emploi :<input type="checkbox" id="job_type"> Temps partiel
  </div>

  <select id="duration" style="width:200px; height:40px;">
    <option value="duration">Durée</option>
  </select>

  <select id="experience" style="width:200px; height:40px;">
    <option value="experience">Expérience souhaitée</option>
  </select>

  <select id="degree" style="width:200px; height:40px;">
    <option value="degree">Niveau d'étude</option>
  </select>

  <div>
    <p>Description du poste :</p>
    <script type="text/javascript" src="http://js.nicedit.com/nicEdit-latest.js"></script>
    <script type="text/javascript">
    bkLib.onDomLoaded(function() { nicEditors.allTextAreas({buttonList : ['fontSize','bold','italic','underline']}) });
    </script>
    <form id="description_area">
      <textarea style="width: 100%; height: 30%;">{{ offer.Description }}</textarea>
    </form>
  </div>

  <img id="image" src="{{ offer.img_src }}" height="15%">
  <input type="file" id="upload" accept="image/*" style="margin-top: 2%;">
  <script>
  file = "";
  image_name = "";
  $('#upload').change(
    function(event) {
      file = event.target.files[0];
      image_name = document.getElementById('upload').files[0].name;
      extension = "."+image_name.split('.').pop();
      $("#image").fadeIn("fast").attr('src', URL.createObjectURL(event.target.files[0]));
    }
  );
  </script>

  <div>
    <button onclick="save()" style="margin-top: 2%;">Save</button>
    <script type="text/javascript">
    function save()
    {
      var title = document.getElementById('title').innerText;
      var reference = document.getElementById('reference').innerText;
      var begin = document.getElementById('begin').value;
      var active = document.getElementById('active').checked ? 1 : 0;
      var department = document.getElementById('department').value;
      var city = document.getElementById('city').value;
      var agency = document.getElementById('agency').value;
      var domain = document.getElementById('domain').value;
      var job = document.getElementById('job').value;
      var job_type = document.getElementById('job_type').checked ? 1 : 0;
      var duration = document.getElementById('duration').value;
      var experience = document.getElementById('experience').value;
      var degree = document.getElementById('degree').value;
      var description = $('#description_area').find('.nicEdit-main').html();

      if (file) {
        var form_data = new FormData();
        var image_id = makeId()+extension;
        form_data.append('file', file);
        form_data.append('name', image_id);
        form_data.append('path', "img/offer/upload/");
        $.ajax({
          url: '/admin/upload.php',
          dataType: 'text',
          cache: false,
          contentType: false,
          processData: false,
          data: form_data,
          type: 'post',
        });
      }

      $.ajax({
        url: '{{ (path('save')) }}',
        type: "POST",
        dataType: "text",
        data: {
          "title": title,
          "reference": reference,
          "active": active,
          "department": department,
          "city": city,
          "agency": agency,
          "domain": domain,
          "job": job,
          "job_type": job_type,
          "duration": duration,
          "experience": experience,
          "degree": degree,
          "begin": begin,
          "img_src": image_id,
          "id": "{{ offer.id }}"
        }
      });
      window.location.href = "{{ path('offer') }}";
    }
    function makeId()
    {
      var text = "";
      var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

      for (var i = 0; i < 5; i++)
      text += possible.charAt(Math.floor(Math.random()*possible.length));

      return text;
    }
    </script>
  </div>

</body>
</html>
